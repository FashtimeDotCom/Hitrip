<style>
	.sort li{

	}
	.sort .mui-table-view.mui-grid-view .mui-table-view-cell{
		margin-right:0;
		padding: 10px 0 0 0px;
	}
	.sort span .mui-icon{
		 color:#ddd;
		 text-align: center;
	}
	.sort span .mui-media-body{
		 margin-left:0px;
	}
	.sort .sel {
		width: 30px;
		height: 30px;
		display: inline-block;
		text-align: center;
		border: 1px solid #ddd;
		border-radius: 15px;
		font-size: 28px;
	}
	.sort .active>span{
		background-color:#0095f6;
		color:#fff;
	}
	.category-keyword .mui-btn {
		padding:1px;
	}
	.goodstpl .mui-table-view.mui-grid-view .mui-table-view-cell{
		margin-right:0;
		padding: 10px 0 0 0px;
	}
	.goodstpl .active{
		border:1px  #0095f6 dotted;
		box-shadow: 2px 2px 2px 2px #0095f6;
	}
	.goodstpl .sel {
		width: 50px;
		height: 50px;
		display: inline-block;
		text-align: center;
		border-radius: 10px;
		font-size: 14px;
		-webkit-background-size: cover;
		-moz-background-size: cover;
		-o-background-size: cover;
		background-size: cover;
	}
</style>
<div class="mui-content" style="margin-top: 0;margin-bottom: 0;">
	<form action="{php echo fm_murl($do,$ac,'load',array())}" method="post" class="mui-input-group" id="form-search" enctype="multipart/form-data" onsubmit="return formcheck('form-search')"  style="padding-bottom: 5px;">
		<input type="hidden" name="isnew" value="{$_GPC['isnew']}" />
		<input type="hidden" name="ishot" value="{$_GPC['ishot']}" />
		<input type="hidden" name="isdiscount" value="{$_GPC['isdiscount']}" />
		<input type="hidden" name="istime" value="{$_GPC['istime']}" />

		<input type="hidden" name="fromplats" value="{$_GPC['fromplats']}" />
		<input type="hidden" name="goodstpl" value="{$goodstpl}" />
		<input type="hidden" name="page" value="{$pindex}" />
		<input type="hidden" name="pcate" value="{$pcate}" />
		<input type="hidden" name="ccate" value="{$ccate}" />
		<input type="hidden" name="token" value="{$_W['token']}" />

		<!-- 产品模型 -->
		{if $settings['shoptype'] !='simple'}
		<div class="goodstpl" style="">
				<ul class="mui-table-view mui-grid-view mui-grid-8" style="text-align: center;padding:0 0 10px 0;">
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3 {if $goodstpl=='hotel'} active {/if} " style="" data-goodstpl="hotel">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/hotel.png);background-size:cover; " >
				</span>
			<div class="mui-media-body">酒店民宿</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3  {if $goodstpl=='tickets'} active {/if} " style="" data-goodstpl="tickets">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/jingqu.png);background-size:cover; " >
				</span>
			<div class="mui-media-body">景区门票</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3  {if $goodstpl=='fruit'} active {/if} " style="" data-goodstpl="fruit">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/fruit.png);background-size:cover; " >
				</span>
			<div class="mui-media-body">水果</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3  {if $goodstpl=='onedaytrip'} active {/if} " style="" data-goodstpl="onedaytrip">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/onedaytrip.png);background-size:cover; " >
				</span>
			<div class="mui-media-body">一日游</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3  {if $goodstpl=='package'} active {/if} " style="" data-goodstpl="package">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/package.png);background-size:cover; ">
				</span>
			<div class="mui-media-body">优惠套餐</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3  {if $goodstpl=='car'} active {/if} " style="" data-goodstpl="car">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/car.png);background-size:cover; " >
				</span>
			<div class="mui-media-body">租车</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3  {if $goodstpl=='seafood'} active {/if} " style="" data-goodstpl="seafood">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/seafood.png);background-size:cover; " >
				</span>
			<div class="mui-media-body">海鲜</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3" style="" data-goodstpl="">
			<span>
				<span class="sel " style="background-image: url({$fm453resource}images/default/all.png);background-size:cover; " >
				</span>
			<div class="mui-media-body">全部类型</div>
			</span>
		</li>
				</ul>
		</div>
		{/if}

		<!--关键词-->
		<div class="" style="margin-top:3px;">
			<div class="mui-input-row" style="height:34px;">
				<input id="search" type="search" name="keyword" class="mui-input  mui-search mui-input-clear" value="{$_GPC['keyword']}" placeholder="在这里输入关键字搜索">
			</div>
		</div>

		<!--排序筛选-->
		<div class="sort" style="">
				<ul class="mui-table-view mui-grid-view mui-grid-6" style="text-align: center;padding:0 0 10px 0;">

		<li class="mui-table-view-cell mui-media mui-col-xs-2 mui-col-sm-2" style="">
			<span orderby="updatetime" showorder="{$sortbyupdatetime}" class="{$allissort['byupdatetime']}" >
				{if $sortbyupdatetime=='desc'}
				<span class="sel mui-icon mui-icon-arrowthindown" style="" id="click-updatetime">
				</span>
				{else}
				<span class="sel mui-icon mui-icon-arrowthinup" style="" id="click-updatetime">
				</span>
				{/if}
			<div class="mui-media-body">时间</div>
			</span>
		</li>
		<input type="hidden" id="hasorderbyupdatetime" name="hasorderbyupdatetime" value="{$hasorderbyupdatetime}"  />
		<input type="hidden" id="byupdatetime" name="byupdatetime" value="{$sortbyupdatetime}" />

		<li class="mui-table-view-cell mui-media mui-col-xs-2 mui-col-sm-2">
			<span orderby="sales" showorder="{$sortbysales}"  class="{$allissort['bysales']}" >
				{if $sortbysales=='desc'}
				<span class="sel mui-icon mui-icon-arrowthindown" style="" id="click-sales">
				</span>
				{else}
				<span class="sel mui-icon mui-icon-arrowthinup" style="" id="click-sales">
				</span>
				{/if}
				<div class="mui-media-body">销量</div>
			</span>
		</li>
		<input type="hidden" id="hasorderbysales"  name="hasorderbysales" value="{$hasorderbysales}" />
		<input type="hidden" id="bysales"  name="bysales" value="{$sortbysales}" />

		<li class="mui-table-view-cell mui-media mui-col-xs-2 mui-col-sm-2">
			<span orderby="view" showorder="{$sortbyview}"  class="{$allissort['byview']}">
				{if $sortbyview=='desc'}
				<span class="sel mui-icon mui-icon-arrowthindown" style=""  id="click-view">
				</span>
				{else}
				<span class="sel mui-icon mui-icon-arrowthinup" style=""  id="click-view">
				</span>
				{/if}
				<div class="mui-media-body">人气</div>
			</span>
		</li>
		<input type="hidden" id="hasorderbyview" name="hasorderbyview" value="{$hasorderbyview}" />
		<input type="hidden" id="byview" name="byview" value="{$sortbyview}" />

		<li class="mui-table-view-cell mui-media mui-col-xs-2 mui-col-sm-2">
			<span orderby="price" showorder="{$sortbyprice}"  class="{$allissort['byprice']}">
				{if $sortbyprice=='desc'}
				<span class="sel mui-icon mui-icon-arrowthindown" style=""  id="click-price">
				</span>
				{else}
				<span class="sel mui-icon mui-icon-arrowthinup" style=""  id="click-price">
				</span>
				{/if}
				<div class="mui-media-body">价格</div>
			</span>
		</li>
		<input type="hidden" id="hasorderbyprice" name="hasorderbyprice" value="{$hasorderbyprice}"  />
		<input type="hidden" id="byprice" name="byprice" value="{$sortbyprice}" />

		<li class="mui-table-view-cell mui-media mui-col-xs-2 mui-col-sm-2">
			<span   orderby="" showorder="" fromplats="all" {if !$OnlyThisMp} class="active" {/if} >
				<span class="sel mui-icon mui-icon-plus" style="" id="click-plat">
				</span>
				<div class="mui-media-body">{if $_GPC['fromplats'] != $_W['uniacid']}全网{else}本店{/if}</div>
			</span>
		</li>
		<li class="mui-table-view-cell mui-media mui-col-xs-2 mui-col-sm-2">
			<span  keywords="rand" {if $keywords} class="active" {/if} >
				<span class="sel mui-icon mui-icon-flag" {if $keywords} style="color:red;" {/if} id="click-keyword">
				</span>
				<div class="mui-media-body">热搜</div>
			</span>
		</li>
				</ul>
		</div>
		<!--分类-->
		<div class="category-keyword" style="margin: 5px;">
				<span class="mui-btn mui-btn-primary mui-btn-outlined" style="margin-top:5px;"><a href="{$allcateurl}" class="bigtype"  style="margin:3px; ">全部</a></span>
				{if $ischild}
				{loop $category $item}
					{if $item['sn']== $pcate}
					<span class="mui-btn mui-btn-warning" style="margin-top:5px;">
					{else}
					<span class="mui-btn mui-btn-primary mui-btn-outlined" style="margin-top:5px;">
				    {/if}
						<a href="{php echo fm_murl($do, $ac, 'load', array('pcate' => $item['sn']))}" class="bigtype" style="margin:3px;">{$item['name']}</a>
					</span>
				{/loop}
				{else}
				{loop $category $item}
					{if $item['sn']== $ccate}
					<span class="mui-btn mui-btn-warning" style="margin-top:5px;">
					{else}
					<span class="mui-btn mui-btn-primary mui-btn-outlined" style="margin-top:5px;">
				    {/if}
						<a href="{php echo fm_murl($do, $ac, 'load', array('ccate' => $item['sn']))}" class="bigtype" style="margin:3px;" >{$item['name']}</a>
					</span>
				{/loop}
				{/if}
		</div>
	<button type="submit" class="hidden" style="display: none;"></button>
	</form>
</div>

<script language='javascript'>
	var isConsole = false;	//是否记录调试日志
	var now_goodstpl = "{$goodstpl}";

	var has_searched = "{$_GPC['keyword']}";	//是否带了搜索词
	var is_searched = $('#search').val();
	//解决当前MUI框架在AJAX结果页中，查看搜索的某条结果后再返回时，搜索词被忽略、数据被刷新的问题
	//——仅针对 有输入了搜索词但并非url传参带入的情况
	if(is_searched != '' && has_searched ==''){
		//该情况下，由于多次不同URL跳转，Form_format函数没有被引入了，故再构造一次
		function Form_format(formid){
			var formid = (typeof(formid)=="string" ? formid : '');
			if (!formid) {
				return false;
			}
			var x = document.getElementById(formid);
			var result={};
			for (var i=0;i<x.length;i++)  {
				var obj = x.elements[i];
				var key = obj.name;
				result[key] = obj.value;
			}
			return result;
		}

		//在H5+ 非IOS 环境中；（IOS返回数据维持了搜索结果，故不刷新页面）
		if(mui.os.plus && !mui.os.ios) {
			formcheck('form-search');
		}else{
			formcheck('form-search');	//非5+环境
		}
	}

	//监听产品模型选择
	mui('.goodstpl').on( 'tap' , 'li' , function(){
		var goodstpl_clicked=this.getAttribute("data-goodstpl");
		$('.goodstpl,li').removeClass("active");
		this.classList.toggle('active');
		document.getElementsByName("goodstpl")[0].value = goodstpl_clicked;
		formcheck('form-search');
	});

	//监听排序设置
	mui('.sort').on( 'tap' , 'span' , function(){
		var orderby = this.getAttribute("orderby");
		var showorder = this.getAttribute("showorder");
		var fromplats = this.getAttribute("fromplats");
		var randkeywords = this.getAttribute("keywords");
		if (orderby || fromplats) {
			ChangeShoworder(this);
		}else {
			if (randkeywords=='rand') {
				getRandKeywords();
			}
		}
	});

	var sortarray={'updatetime':0,'sales':0,'view':0,'price':0};
	var orderarray={'desc':'asc','asc':'desc'};
	function ChangeShoworder(obj) {
		var orderby = obj.getAttribute("orderby");
		var showorder = obj.getAttribute("showorder");
		var fromplats = obj.getAttribute("fromplats");
		var randkeywords = obj.getAttribute("keywords");
		if (orderby) {
			sortarray[orderby]++;
			var k = sortarray[orderby];
			if (k>2) {
				document.getElementsByName("hasorderby"+orderby)[0].value='false';
				sortarray[orderby]=0;
				obj.classList.toggle('active');
			}else {
				document.getElementsByName("hasorderby"+orderby)[0].value='true';
				if (k==1) {
					obj.classList.toggle('active');
				}
				var sortspan = $("#click-"+orderby);
				if (showorder=='desc') {
					obj.setAttribute("showorder",orderarray[showorder]);
					$("#by"+orderby).val('asc');
				 	sortspan.addClass('mui-icon-arrowthinup').removeClass('mui-icon-arrowthindown').removeClass('mui-icon-pulldown');
				}else {
					showorder = 'asc';
					obj.setAttribute("showorder",orderarray[showorder]);
					$("#by"+orderby).val('desc');
				 	sortspan.removeClass('mui-icon-arrowthinup').addClass('mui-icon-pulldown');
				}
				document.getElementById('click-' + orderby).value=orderarray[showorder];
			}
		}
		if (fromplats) {
			var new_plat = (fromplats=='all') ? "{$_W['uniacid']}" : 'all';
			var plattitle = {"all":"全网","{$_W['uniacid']}":"本店"}
			document.getElementsByName('fromplats')[0].value=new_plat;
			obj.setAttribute("fromplats",new_plat);
			obj.classList.toggle('active');
			$("#click-plat").next().html(plattitle[new_plat]);
			$('#showstatus').html(fromplats);
		}

		formcheck('form-search');
	}

	function getRandKeywords() {
		var url = "{php echo fm_murl('ajax','index','randkeyword',array())}";
		var data = {
			'type' : "goods"
		};
		mui.getJSON(url,data,
			function(res){
				$('#search').val(res);//替换内容
				formcheck('form-search');
			}
		);
	}

	function formcheck(formid) {
		var form = document.getElementById(formid);
		var formdata = Form_format(formid); //自有方法格式化表单元素，返回数组
		var container = 'search-list-table';
		var url = "{php echo fm_murl($do,$ac,'addsearch',array('changeorder'=>1))}";
		var data = formdata;
		data['refresh']=1;
		if(isConsole){
			console.log(data);
		}
		$('#showstatus').html('正在搜索…');//替换内容
		$('#pagename').html('正在搜索…');//替换内容
		$.get(url,data,function(res){
			$('#'+container).html(res);//替换内容
			$('#showstatus').html('结果已刷新!');//替换内容
			$('#pagename').html('结果已刷新!');//替换内容
		},'html');
		$('input').blur();	//让输入框失焦，以关闭键盘
		return false;
	}
</script>